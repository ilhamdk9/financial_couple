<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Financial Couple — Ilham ❤️ Adel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ff4d6d;--rose:#ffe0e6;--cream:#fff7f9;--ink:#2a2a2a;
      --muted:#6b6b6b;--radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Poppins,sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--cream),#fff);}
    header{position:sticky;top:0;background:#fff9;border-bottom:1px solid #ffd6e0;backdrop-filter:blur(8px);}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;gap:18px}
    @media(min-width:780px){.grid{grid-template-columns:1.2fr 1fr}}
    .card{background:#fff;border:1px solid #ffd6e0;border-radius:var(--radius);box-shadow:0 8px 20px -10px #ff4d6d44}
    .card .head{padding:14px 16px;border-bottom:1px solid #ffd6e0;background:#fff7fa;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);display:flex;justify-content:space-between;align-items:center}
    .card .body{padding:16px}
    form{display:grid;gap:12px}
    .row{display:grid;gap:12px}
    @media(min-width:560px){.row.two{grid-template-columns:1fr 1fr}.row.three{grid-template-columns:1fr 1fr 1fr}.row.four{grid-template-columns:repeat(4,1fr)}}
    input,select,button{padding:10px;border-radius:12px;border:1px solid #ffd6e0;font:inherit}
    button{cursor:pointer;background:var(--pink);color:#fff;font-weight:700;border:0}
    .muted-btn{background:#fff;color:var(--pink);border:1px solid #ffbccc}
    .list{display:grid;gap:10px;max-height:250px;overflow:auto}
    .item{display:grid;grid-template-columns:auto 1fr auto;align-items:center;padding:8px 10px;border:1px solid #ffd6e0;border-radius:12px}
    .badge{padding:2px 8px;border-radius:8px;background:#fff0f4;border:1px solid #ffbccc;font-size:11px;color:#c2183e;font-weight:600}
    .amount{font-weight:700}
    .small{font-size:12px;color:#777}
  </style>
</head>
<body>
  <header>
    <div class="wrap"><h1>Financial Couple — Ilham ❤️ Adel</h1></div>
  </header>

  <main class="wrap">
    <!-- Ringkasan -->
    <section class="card">
      <div class="head"><b>Ringkasan Saldo</b></div>
      <div class="body">
        <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px">
          <div><div>Ilham</div><div id="ilhamBalance" class="amount">Rp 0</div></div>
          <div><div>Adel</div><div id="adelBalance" class="amount">Rp 0</div></div>
          <div><div>Bersama</div><div id="sharedBalance" class="amount">Rp 0</div></div>
          <div><div>Total</div><div id="grandTotal" class="amount">Rp 0</div></div>
        </div>
      </div>
    </section>

    <div class="grid" style="margin-top:18px">
      <!-- Kiri -->
      <section class="grid" style="gap:18px">
        <!-- Urunan -->
        <div class="card">
          <div class="head"><b>Urunan Bulanan</b></div>
          <div class="body">
            <form id="contribForm">
              <div class="row.three row">
                <select id="contribPerson" required>
                  <option value="ilham">Ilham</option>
                  <option value="adel">Adel</option>
                </select>
                <input id="contribMonth" type="month" required/>
                <input id="contribAmount" type="number" placeholder="700000" required/>
              </div>
              <button type="submit">+ Tambah Urunan</button>
            </form>
            <div class="list" id="contribList"></div>
          </div>
        </div>

        <!-- Pengeluaran -->
        <div class="card">
          <div class="head"><b>Pengeluaran Harian</b></div>
          <div class="body">
            <form id="expenseForm">
              <div class="row.four row">
                <select id="expPerson" required><option value="ilham">Ilham</option><option value="adel">Adel</option></select>
                <select id="expSource" required><option value="individual">Masing-masing</option><option value="shared">Bersama</option></select>
                <input id="expAmount" type="number" placeholder="120000" required/>
                <input id="expDate" type="date" required/>
              </div>
              <input id="expNote" type="text" placeholder="Catatan (opsional)"/>
              <button type="submit">+ Catat Pengeluaran</button>
            </form>
            <div class="list" id="expenseList"></div>
          </div>
        </div>

        <!-- Penambahan Uang -->
        <div class="card">
          <div class="head"><b>Penambahan Uang</b> <span class="small">(contoh: gaji bulanan)</span></div>
          <div class="body">
            <form id="incomeForm">
              <div class="row.three row">
                <select id="incPerson" required><option value="ilham">Ilham</option><option value="adel">Adel</option></select>
                <input id="incAmount" type="number" placeholder="5000000" required/>
                <input id="incDate" type="date" required/>
              </div>
              <input id="incNote" type="text" placeholder="Catatan (opsional)"/>
              <button type="submit">+ Tambah Uang</button>
            </form>
            <div class="list" id="incomeList"></div>
          </div>
        </div>
      </section>

      <!-- Kanan -->
      <section class="grid" style="gap:18px">
        <div class="card"><div class="head"><b>Riwayat</b></div><div class="body"><div class="list" id="recentList"></div></div></div>
      </section>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, setDoc, deleteDoc, onSnapshot, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCX2a-f1UK7iVC-TlmE2iekJMwIs5ccDQU",
      authDomain: "financial-couple-dc3cf.firebaseapp.com",
      projectId: "financial-couple-dc3cf",
      storageBucket: "financial-couple-dc3cf.firebasestorage.app",
      messagingSenderId: "533254877895",
      appId: "1:533254877895:web:52b21c324bcf20f46704e2",
      measurementId: "G-CJ8VGQGPK0"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const DEFAULT_ILHAM=5700000, DEFAULT_ADEL=13000000;
    const fmt = n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n||0);
    const today=()=>new Date().toISOString().slice(0,10);

    // Elements
    const ilhamBalanceEl=document.getElementById('ilhamBalance');
    const adelBalanceEl=document.getElementById('adelBalance');
    const sharedBalanceEl=document.getElementById('sharedBalance');
    const grandTotalEl=document.getElementById('grandTotal');
    const contribList=document.getElementById('contribList');
    const expenseList=document.getElementById('expenseList');
    const incomeList=document.getElementById('incomeList');
    const recentList=document.getElementById('recentList');

    // State
    let state={ilhamInit:DEFAULT_ILHAM, adelInit:DEFAULT_ADEL, contribs:[], expenses:[], incomes:[]};

    // Snapshot listeners
    onSnapshot(doc(db,'meta','initialBalances'),snap=>{
      if(snap.exists()){const d=snap.data();state.ilhamInit=d.ilham||DEFAULT_ILHAM;state.adelInit=d.adel||DEFAULT_ADEL;render();}
    });
    onSnapshot(query(collection(db,'contributions'),orderBy('createdAt','desc')),qs=>{
      state.contribs=qs.docs.map(d=>({id:d.id,...d.data()}));render();
    });
    onSnapshot(query(collection(db,'expenses'),orderBy('createdAt','desc')),qs=>{
      state.expenses=qs.docs.map(d=>({id:d.id,...d.data()}));render();
    });
    onSnapshot(query(collection(db,'incomes'),orderBy('createdAt','desc')),qs=>{
      state.incomes=qs.docs.map(d=>({id:d.id,...d.data()}));render();
    });

    // Forms
    document.getElementById('contribForm').onsubmit=async e=>{
      e.preventDefault();const person=contribPerson.value,month=contribMonth.value,amount=+contribAmount.value;
      if(amount>0)await addDoc(collection(db,'contributions'),{person,month,amount,createdAt:serverTimestamp()});
      contribAmount.value='';
    };
    document.getElementById('expenseForm').onsubmit=async e=>{
      e.preventDefault();const person=expPerson.value,source=expSource.value,amount=+expAmount.value,date=expDate.value,note=expNote.value||'';
      if(amount>0)await addDoc(collection(db,'expenses'),{person,source,amount,date,note,createdAt:serverTimestamp()});
      expAmount.value='';expNote.value='';
    };
    document.getElementById('incomeForm').onsubmit=async e=>{
      e.preventDefault();const person=incPerson.value,amount=+incAmount.value,date=incDate.value,note=incNote.value||'';
      if(amount>0)await addDoc(collection(db,'incomes'),{person,amount,date,note,createdAt:serverTimestamp()});
      incAmount.value='';incNote.value='';
    };

    // Render
    function render(){
      const ilhamU=sum(state.contribs.filter(c=>c.person==='ilham').map(c=>c.amount));
      const adelU =sum(state.contribs.filter(c=>c.person==='adel').map(c=>c.amount));
      const ilhamOut=sum(state.expenses.filter(e=>e.person==='ilham'&&e.source==='individual').map(e=>e.amount));
      const adelOut =sum(state.expenses.filter(e=>e.person==='adel' &&e.source==='individual').map(e=>e.amount));
      const sharedOut=sum(state.expenses.filter(e=>e.source==='shared').map(e=>e.amount));
      const ilhamInc=sum(state.incomes.filter(i=>i.person==='ilham').map(i=>i.amount));
      const adelInc =sum(state.incomes.filter(i=>i.person==='adel' ).map(i=>i.amount));

      const ilhamSaldo=state.ilhamInit - ilhamU - ilhamOut + ilhamInc;
      const adelSaldo =state.adelInit  - adelU  - adelOut  + adelInc;
      const sharedSaldo= (ilhamU+adelU) - sharedOut;
      const grand=ilhamSaldo+adelSaldo+sharedSaldo;

      ilhamBalanceEl.textContent=fmt(ilhamSaldo);
      adelBalanceEl.textContent=fmt(adelSaldo);
      sharedBalanceEl.textContent=fmt(sharedSaldo);
      grandTotalEl.textContent=fmt(grand);

      contribList.innerHTML=state.contribs.map(c=>`<div class="item"><span class="badge">Urunan</span><div>${c.person} - ${fmt(c.amount)} (${c.month})</div></div>`).join('');
      expenseList.innerHTML=state.expenses.map(e=>`<div class="item"><span class="badge">${e.source}</span><div>${e.person} - ${fmt(e.amount)} (${e.date})</div></div>`).join('');
      incomeList.innerHTML=state.incomes.map(i=>`<div class="item"><span class="badge">Income</span><div>${i.person} +${fmt(i.amount)} (${i.date})</div></div>`).join('');

      const recent=[...state.contribs.map(x=>({...x,type:'U'})),...state.expenses.map(x=>({...x,type:'E'})),...state.incomes.map(x=>({...x,type:'I'}))].sort((a,b)=>b.createdAt?.toMillis()-a.createdAt?.toMillis()).slice(0,10);
      recentList.innerHTML=recent.map(r=>{
        if(r.type==='U')return `<div class="item"><span class="badge">Urunan</span><div>${r.person} - ${fmt(r.amount)}</div></div>`;
        if(r.type==='E')return `<div class="item"><span class="badge">Out</span><div>${r.person} - ${fmt(r.amount)}</div></div>`;
        return `<div class="item"><span class="badge">Income</span><div>${r.person} +${fmt(r.amount)}</div></div>`;
      }).join('');
    }
    function sum(a){return a.reduce((x,y)=>x+(+y||0),0)}
    incDate.value=today();expDate.value=today();contribMonth.value=today().slice(0,7);
  </script>
</body>
</html>
