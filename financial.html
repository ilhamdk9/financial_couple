<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Financial Couple — Ilham ❤️ Adel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#ff4d6d">
  <link rel="icon" href="icons/heart-192.png" type="image/png">
  <link rel="apple-touch-icon" href="icons/heart-192.png">
  <style>
    :root {
      --pink: #ff4d6d;
      --rose: #ffe0e6;
      --cream: #fff7f9;
      --ink: #2a2a2a;
      --muted: #6b6b6b;
      --radius: 1rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Poppins, sans-serif;
      color: var(--ink);
      background: linear-gradient(180deg, var(--cream), #fff);
      line-height: 1.5;
    }

    header {
      position: sticky;
      top: 0;
      background: #fff9;
      border-bottom: 1px solid #ffd6e0;
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem;
    }

    h1 {
      margin: 0;
      font-size: clamp(1rem, 2vw, 1.5rem);
    }

    .grid {
      display: grid;
      gap: 1rem;
    }

    /* grid otomatis responsif */
    @media (min-width: 780px) {
      .grid.two-col {
        grid-template-columns: 1.2fr 1fr;
      }
    }

    .card {
      background: #fff;
      border: 1px solid #ffd6e0;
      border-radius: var(--radius);
      box-shadow: 0 8px 20px -10px #ff4d6d44;
    }

    .card .head {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #ffd6e0;
      background: #fff7fa;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: .5rem;
    }

    .card .body {
      padding: 1rem;
    }

    form {
      display: grid;
      gap: .75rem;
    }

    .row {
      display: grid;
      gap: .75rem;
    }

    header {
      background: #ff4d6d;
      color: white;
      padding: 1rem;
    }
    header .wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hamburger {
      font-size: 1.5rem;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }

    #sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 220px;
      height: 100%;
      background: #ffe0e6;
      box-shadow: 2px 0 6px rgba(0,0,0,0.2);
      transition: left 0.3s ease;
      padding-top: 4rem;
    }
    #sidebar.active {
      left: 0;
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
    }
    #sidebar ul li {
      padding: 1rem;
    }
    #sidebar ul li a {
      text-decoration: none;
      color: #333;
      font-weight: 600;
    }


    /* kolom responsif */
    @media (min-width: 560px) {
      .row.two {
        grid-template-columns: repeat(2, 1fr);
      }

      .row.three {
        grid-template-columns: repeat(3, 1fr);
      }

      .row.four {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    input,
    select,
    button {
      padding: .65rem .75rem;
      border-radius: .75rem;
      border: 1px solid #ffd6e0;
      font: inherit;
      width: 100%;
    }

    button {
      cursor: pointer;
      background: var(--pink);
      color: #fff;
      font-weight: 700;
      border: 0;
      transition: background .2s;
      margin-bottom: 10px;
      margin-top: 10px;
    }

    button:hover {
      background: #e53b5d;
    }

    .muted-btn {
      background: #fff;
      color: var(--pink);
      border: 1px solid #ffbccc;
    }

    .list {
      display: grid;
      gap: .6rem;
      max-height: 250px;
      overflow: auto;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 8px;
      background: #fff0f4;
      border: 1px solid #ffbccc;
      font-size: .7rem;
      color: #c2183e;
      font-weight: 600;
    }

    .amount {
      font-weight: 700;
    }

    .small {
      font-size: .8rem;
      color: #777;
    }

    /* agar konten utama 2 kolom hanya di layar lebar */
    .main-grid {
      display: grid;
      gap: 1rem;
    }

    .item {
      padding: 1rem;
      border: 1px solid #ffd6e0;
      border-radius: 1rem;
      background: #fff;
      margin-bottom: 1rem;
      box-shadow: 0 4px 10px -6px rgba(255, 77, 109, .3);
    }

    .item-header {
      display: flex;
      flex-direction: column;
      gap: .25rem;
    }

    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      background: #ffe0eb;
      font-size: .75rem;
      color: #ff4d6d;
      font-weight: 600;
      margin-bottom: .3rem;
      width: max-content;
    }

    .label {
      font-weight: 600;
      color: #333;
    }

    .note {
      font-size: .85rem;
      margin: .4rem 0;
      color: #666;
      font-style: italic;
    }

    .item-footer {
      margin-top: .6rem;
      display: flex;
      justify-content: flex-end;
      gap: .5rem;
    }

    .btn-action {
      padding: .35rem .7rem;
      border: none;
      border-radius: .5rem;
      font-size: .85rem;
      cursor: pointer;
      background: #ffe0eb;
      color: #ff4d6d;
      transition: all .2s ease;
    }

    .btn-action:hover {
      background: #ff4d6d;
      color: #fff;
    }

    @media (min-width: 780px) {
      .main-grid {
        grid-template-columns: 1.2fr 1fr;
      }
    }
  </style>
</head>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}

// opsional: tombol install
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  window.deferredPrompt = e;
  const btn = document.getElementById('installPWA');
  if (btn) btn.style.display = 'inline-flex';
});

async function installPWA() {
  const prompt = window.deferredPrompt;
  if (!prompt) return;
  prompt.prompt();
  await prompt.userChoice;
  window.deferredPrompt = null;
  const btn = document.getElementById('installPWA');
  if (btn) btn.style.display = 'none';
}
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const menuBtn = document.getElementById("menu-btn");
    const sidebar = document.getElementById("sidebar");

    menuBtn.addEventListener("click", () => {
      sidebar.classList.toggle("active");
    });
  });
</script>

<!-- contoh tombol (opsional) -->
<button id="installPWA" onclick="installPWA()" style="display:none"
  class="muted-btn" aria-label="Install App">⬇️ Install App</button>
<body>
  <header>
    <div class="wrap">
      <h1>Financial</h1>
    </div>
  </header>

  <main class="wrap">
    <!-- Ringkasan -->
    <section class="card">
      <div class="head"><b>Ringkasan Saldo</b></div>
      <div class="body">
        <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px">
          <div><div>Ilham</div><div id="ilhamBalance" class="amount">Rp 0</div></div>
          <div><div>Adel</div><div id="adelBalance" class="amount">Rp 0</div></div>
          <div><div>Bersama</div><div id="sharedBalance" class="amount">Rp 0</div></div>
          <div><div>Total</div><div id="grandTotal" class="amount">Rp 0</div></div>
        </div>
      </div>
    </section>

    <div class="grid" style="margin-top:18px">
      <!-- Kiri -->
      <section class="grid" style="gap:18px">
        <!-- Urunan -->
        <div class="card">
          <div class="head"><b>Urunan Bulanan</b></div>
          <div class="body">
            <form id="contribForm">
              <div class="row.three row">
                <select id="contribPerson" required>
                  <option value="ilham">Ilham</option>
                  <option value="adel">Adel</option>
                </select>
                <input id="contribMonth" type="month" required/>
                <input id="contribAmount" type="number" placeholder="700000" required/>
              </div>
              <button type="submit">+ Tambah Urunan</button>
            </form>
            <div class="list" id="contribList"></div>
          </div>
        </div>

        <!-- Pengeluaran -->
        <div class="card">
          <div class="head"><b>Pengeluaran Harian</b></div>
          <div class="body">
            <form id="expenseForm">
              <div class="row.four row">
                <select id="expPerson" required><option value="ilham">Ilham</option><option value="adel">Adel</option></select>
                <select id="expSource" required><option value="individual">Masing-masing</option><option value="shared">Bersama</option></select>
                <input id="expAmount" type="number" placeholder="120000" required/>
                <input id="expDate" type="date" required/>
              </div>
              <input id="expNote" type="text" placeholder="Catatan (opsional)"/>
              <button type="submit">+ Catat Pengeluaran</button>
            </form>
            <div class="list" id="expenseList"></div>
          </div>
        </div>

        <!-- Penambahan Uang -->
        <div class="card">
          <div class="head"><b>Penambahan Uang</b> <span class="small">(contoh: gaji bulanan)</span></div>
          <div class="body">
            <form id="incomeForm">
              <div class="row.three row">
                <select id="incPerson" required><option value="ilham">Ilham</option><option value="adel">Adel</option></select>
                <input id="incAmount" type="number" placeholder="5000000" required/>
                <input id="incDate" type="date" required/>
              </div>
              <input id="incNote" type="text" placeholder="Catatan (opsional)"/>
              <button type="submit">+ Tambah Uang</button>
            </form>
            <div class="list" id="incomeList"></div>
          </div>
        </div>
      </section>

      <!-- Kanan -->
      <section class="grid" style="gap:18px">
        <div class="card"><div class="head"><b>Riwayat</b></div><div class="body"><div class="list" id="recentList"></div></div></div>
      </section>
    </div>
  </main>
  <script type="module">
  import { 
    initializeApp 
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { 
    getFirestore, collection, addDoc, doc, setDoc, deleteDoc, updateDoc, 
    onSnapshot, orderBy, query, serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCX2a-f1UK7iVC-TlmE2iekJMwIs5ccDQU",
    authDomain: "financial-couple-dc3cf.firebaseapp.com",
    projectId: "financial-couple-dc3cf",
    storageBucket: "financial-couple-dc3cf.firebasestorage.app",
    messagingSenderId: "533254877895",
    appId: "1:533254877895:web:52b21c324bcf20f46704e2",
    measurementId: "G-CJ8VGQGPK0"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const DEFAULT_ILHAM=4636953, DEFAULT_ADEL=14010326;
  const fmt = n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n||0);
  const today=()=>new Date().toISOString().slice(0,10);

  // Elements
  const ilhamBalanceEl=document.getElementById('ilhamBalance');
  const adelBalanceEl=document.getElementById('adelBalance');
  const sharedBalanceEl=document.getElementById('sharedBalance');
  const grandTotalEl=document.getElementById('grandTotal');
  const contribList=document.getElementById('contribList');
  const expenseList=document.getElementById('expenseList');
  const incomeList=document.getElementById('incomeList');
  const recentList=document.getElementById('recentList');

  // State
  let state={ilhamInit:DEFAULT_ILHAM, adelInit:DEFAULT_ADEL, contribs:[], expenses:[], incomes:[]};

  // Snapshot listeners
  onSnapshot(doc(db,'meta','initialBalances'),snap=>{
    if(snap.exists()){const d=snap.data();state.ilhamInit=d.ilham||DEFAULT_ILHAM;state.adelInit=d.adel||DEFAULT_ADEL;render();}
  });
  onSnapshot(query(collection(db,'contributions'),orderBy('createdAt','desc')),qs=>{
    state.contribs=qs.docs.map(d=>({id:d.id,...d.data()}));render();
  });
  onSnapshot(query(collection(db,'expenses'),orderBy('createdAt','desc')),qs=>{
    state.expenses=qs.docs.map(d=>({id:d.id,...d.data()}));render();
  });
  onSnapshot(query(collection(db,'incomes'),orderBy('createdAt','desc')),qs=>{
    state.incomes=qs.docs.map(d=>({id:d.id,...d.data()}));render();
  });

  // Forms
  document.getElementById('contribForm').onsubmit=async e=>{
    e.preventDefault();const person=contribPerson.value,month=contribMonth.value,amount=+contribAmount.value;
    if(amount>0)await addDoc(collection(db,'contributions'),{person,month,amount,createdAt:serverTimestamp()});
    contribAmount.value='';
  };
  document.getElementById('expenseForm').onsubmit=async e=>{
    e.preventDefault();const person=expPerson.value,source=expSource.value,amount=+expAmount.value,date=expDate.value,note=expNote.value||'';
    if(amount>0)await addDoc(collection(db,'expenses'),{person,source,amount,date,note,createdAt:serverTimestamp()});
    expAmount.value='';expNote.value='';
  };
  document.getElementById('incomeForm').onsubmit=async e=>{
    e.preventDefault();const person=incPerson.value,amount=+incAmount.value,date=incDate.value,note=incNote.value||'';
    if(amount>0)await addDoc(collection(db,'incomes'),{person,amount,date,note,createdAt:serverTimestamp()});
    incAmount.value='';incNote.value='';
  };

  // Edit & Delete
  async function deleteItem(type,id){
    let col="";
    if(type==="U") col="contributions";
    if(type==="E") col="expenses";
    if(type==="I") col="incomes";
    if(col && confirm("Yakin mau hapus data ini?")){
      await deleteDoc(doc(db,col,id));
    }
  }

  async function editItem(type,id){
    let col="";
    if(type==="U") col="contributions";
    if(type==="E") col="expenses";
    if(type==="I") col="incomes";
    if(!col) return;

    const newAmount=prompt("Masukkan nominal baru:");
    if(newAmount && !isNaN(newAmount)){
      await updateDoc(doc(db,col,id),{amount:+newAmount});
    }
  }

  // Render
  function render(){
    const ilhamU=sum(state.contribs.filter(c=>c.person==='ilham').map(c=>c.amount));
    const adelU =sum(state.contribs.filter(c=>c.person==='adel').map(c=>c.amount));
    const ilhamOut=sum(state.expenses.filter(e=>e.person==='ilham'&&e.source==='individual').map(e=>e.amount));
    const adelOut =sum(state.expenses.filter(e=>e.person==='adel' &&e.source==='individual').map(e=>e.amount));
    const sharedOut=sum(state.expenses.filter(e=>e.source==='shared').map(e=>e.amount));
    const ilhamInc=sum(state.incomes.filter(i=>i.person==='ilham').map(i=>i.amount));
    const adelInc =sum(state.incomes.filter(i=>i.person==='adel' ).map(i=>i.amount));

    const ilhamSaldo=state.ilhamInit - ilhamU - ilhamOut + ilhamInc;
    const adelSaldo =state.adelInit  - adelU  - adelOut  + adelInc;
    const sharedSaldo= (ilhamU+adelU) - sharedOut;
    const grand=ilhamSaldo+adelSaldo+sharedSaldo;

    ilhamBalanceEl.textContent=fmt(ilhamSaldo);
    adelBalanceEl.textContent=fmt(adelSaldo);
    sharedBalanceEl.textContent=fmt(sharedSaldo);
    grandTotalEl.textContent=fmt(grand);

    // Contributions
    contribList.innerHTML = state.contribs.map(c => `
      <div class="item">
        <div class="item-header">
          <span class="badge">Urunan</span>
          <div class="label">${c.person} - ${fmt(c.amount)} (${c.month})</div>
        </div>
        ${c.note ? `<p class="note">${c.note}</p>` : ""}
        <div class="item-footer">
          <button onclick="editItem('U','${c.id}')" class="btn-action">✏️ Edit</button>
          <button onclick="deleteItem('U','${c.id}')" class="btn-action">🗑️ Hapus</button>
        </div>
      </div>
    `).join("");

    // Expenses
    expenseList.innerHTML = state.expenses.map(e => `
      <div class="item">
        <div class="item-header">
          <span class="badge">${e.source}</span>
          <div class="label">${e.person} - ${fmt(e.amount)} (${e.date})</div>
        </div>
        ${e.note ? `<p class="note">${e.note}</p>` : ""}
        <div class="item-footer">
          <button onclick="editItem('E','${e.id}')" class="btn-action">✏️ Edit</button>
          <button onclick="deleteItem('E','${e.id}')" class="btn-action">🗑️ Hapus</button>
        </div>
      </div>
    `).join("");

    // Incomes
    incomeList.innerHTML = state.incomes.map(i => `
      <div class="item">
        <div class="item-header">
          <span class="badge">Income</span>
          <div class="label">${i.person} +${fmt(i.amount)} (${i.date})</div>
        </div>
        ${i.note ? `<p class="note">${i.note}</p>` : ""}
        <div class="item-footer">
          <button onclick="editItem('I','${i.id}')" class="btn-action">✏️ Edit</button>
          <button onclick="deleteItem('I','${i.id}')" class="btn-action">🗑️ Hapus</button>
        </div>
      </div>
    `).join("");

    // Recent
    const recent = [
      ...state.contribs.map(x => ({ ...x, type: 'U' })),
      ...state.expenses.map(x => ({ ...x, type: 'E' })),
      ...state.incomes.map(x => ({ ...x, type: 'I' }))
    ].sort((a, b) => b.createdAt?.toMillis() - a.createdAt?.toMillis())
    .slice(0, 10);

    recentList.innerHTML = recent.map(r => {
      let badge = "", label = "";
      if (r.type === 'U') { badge = "Urunan"; label = `${r.person} - ${fmt(r.amount)}`; }
      if (r.type === 'E') { badge = "Out"; label = `${r.person} - ${fmt(r.amount)}`; }
      if (r.type === 'I') { badge = "Income"; label = `${r.person} +${fmt(r.amount)}`; }

      return `
        <div class="item">
          <div class="item-header">
            <span class="badge">${badge}</span>
            <div class="label">${label}</div>
          </div>
          ${r.note ? `<p class="note">${r.note}</p>` : ""}
          <div class="item-footer">
            <button onclick="editItem('${r.type}','${r.id}')" class="btn-action">✏️ Edit</button>
            <button onclick="deleteItem('${r.type}','${r.id}')" class="btn-action">🗑️ Hapus</button>
          </div>
        </div>
      `;
    }).join("");

  }

  function sum(a){return a.reduce((x,y)=>x+(+y||0),0)}
  incDate.value=today();expDate.value=today();contribMonth.value=today().slice(0,7);

  // Supaya fungsi bisa dipanggil dari HTML
  window.deleteItem=deleteItem;
  window.editItem=editItem;
  </script>


</body>
</html>